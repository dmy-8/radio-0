!function(){"use strict";function t(t,e){t.width=e.clientWidth,t.height=e.clientHeight}const e=(e,i)=>{if(!e||!i)return;const r={fftSize:i.dataset.fftSize||2048,numBars:i.dataset.bars||120,maxHeight:i.clientHeight||200},n=new AudioContext,a=n.createMediaElementSource(e),s=n.createAnalyser();a.connect(s),a.connect(n.destination);const o=new Uint8Array(s.frequencyBinCount),l=function(t){const e=document.createElement("canvas");return e.setAttribute("id","visualizerCanvas"),e.setAttribute("class","visualizer-item"),t.appendChild(e),e.width=t.clientWidth,e.height=t.clientHeight,e}(i),c=l.getContext("2d"),u=()=>{t(l,i),s.getByteFrequencyData(o),r.fftSize&&(s.fftSize=r.fftSize),c.clearRect(0,0,l.width,l.height);for(let t=0;t<r.numBars;t++){const e=Math.floor((t+10)*(t<r.numBars/2?2:1)),i=o[e],n=Math.max(4,i/255*r.maxHeight),a=l.width/r.numBars,s=t*a,u=l.height-n;c.fillStyle="white",c.fillRect(s,u,a-2,n)}requestAnimationFrame(u)};u(),window.addEventListener("resize",(()=>{t(l,i)}))},i={},r="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAAAXNSR0IArs4c6QAAAA1JREFUGFdjYGBgaAAAAIUAgbVRNccAAAAASUVORK5CYII=",n={facebook:'<i class="ri-facebook-circle-fill"></i>',messenger:'<i class="ri-messenger-fill"></i>',youtube:'<i class="ri-youtube-fill"></i>',instagram:'<i class="ri-instagram-fill"></i>',whatsapp:'<i class="ri-whatsapp-fill"></i>',tiktok:'<i class="ri-tiktok-fill"></i>',play:'<i class="ri-play-fill"></i>',pause:'<i class="ri-pause-fill"></i>',volumeDown:'<i class="ri-volume-down-fill"></i>',volumeMute:'<i class="ri-volume-mute-fill"></i>',volumeUp:'<i class="ri-volume-up-fill"></i>',spotify:'<i class="ri-spotify-fill"></i>',bluesky:'<i class="ri-bluesky-fill"></i>',discord:'<i class="ri-discord-fill"></i>',soundcloud:'<i class="ri-soundcloud-fill"></i>',threads:'<i class="ri-threads-fill"></i>',twitter:'<i class="ri-twitter-fill"></i>',x:'<i class="ri-twitter-x-fill"></i>'};function a(t){return t.replace(/^\d+\.\)\s/,"").replace(/<br>$/,"")}function s(t){let e,i;return(t.song_history||t.history||t.songHistory||[]).map((r=>(t.song_history?(e=r.song.artist,i=r.song.title):t.history?(e=a(r.split(" - ")[0]||r),i=a(r.split(" - ")[1]||r)):t.songHistory&&(e=r.artist,i=r.title||r.song),{artist:e,title:i})))}function o(t){let e,i;return t.now_playing?(e=t.now_playing.song.title,i=t.now_playing.song.artist):t.artist&&t.title?(e=t.title,i=t.artist):t.currenttrack_title?(e=t.currenttrack_title,i=t.currenttrack_artist):t.title&&t.djprofile&&t.djusername?(e=t.title.split(" - ")[1],i=t.title.split(" - ")[0]):(e=t.currentSong,i=t.currentArtist),{title:e,artist:i}}async function l(t){try{return await(async t=>{const e=await fetch(`https://radioapi.lat/search?query=${t}`),i=await e.json();return i.results?i.results:{}})(t)}catch(e){return await(async t=>{const e=await fetch(`https://itunes.apple.com/search?term=${t}&entity=song&limit=1`),i=await e.json();return i.results?i.results[0]:{}})(t)}}function c(t){return new Promise(((e,i)=>{const r=new Image;r.onload=()=>e(r),r.onerror=i,r.src=t}))}const u=document.querySelector(".miniplayer-button-play"),d=document.querySelector(".visualizer");let m,f,y;const p=window?.miniPlayer?.timeRefresh||5e3,g=window?.miniPlayer?.audioApi||!1,h=window?.miniPlayer?.streamUrl||!1,w=new Audio;function v(){w.load(),w.play(),u.innerHTML=`${n.pause}`,u.classList.add("is-active"),document.body.classList.add("is-playing"),m||(e(w,d),m=!0)}function A(){w.pause(),u.innerHTML=`${n.play}`,u.classList.remove("is-active"),document.body.classList.remove("is-playing")}w.src=h,w.crossOrigin="anonymous",null!==u&&u.addEventListener("click",(async()=>{w.paused?v():A()}));const k=document.querySelector(".miniplayer-volume-input"),S=document.querySelector(".miniplayer-range-fill"),b=document.querySelector(".miniplayer-range-wrapper"),E=document.querySelector(".miniplayer-range-thumb"),L=document.querySelector(".miniplayer-volume-toggle"),x=localStorage.getItem("volume")||100;function U(t){S.style.width=`${t}%`}function q(t){const e=t/100*(b.offsetWidth-E.offsetWidth);E.style.left=`${e}px`}function $(t){k.value=t,U(t),q(t),localStorage.setItem("volume",t),w.volume=t/100,L.innerHTML=0===t?n.volumeMute:n.volumeUp}function z(t){const e=k.getBoundingClientRect();let i=(t.clientX-e.left)/k.offsetWidth*100;i=Math.max(0,Math.min(100,i));$(Math.round((k.max-k.min)*(i/100))+parseInt(k.min))}function H(t){const{title:e,artwork:i,artworkUrl100:r,artworkUrl500:n,artworkUrl1000:a}=t,s=document.querySelector(".miniplayer-title");s&&(s.textContent=e);const o=document.querySelector(".miniplayer-player-image"),l=i||n;o&&c(l).then((()=>function(t,e){const i=document.createElement("img"),r=t.clientHeight;i.src=e,i.width=r,i.height=r,t.appendChild(i);const n=t.querySelector("img:first-child");n.style.marginLeft=`-${r}px`,n.addEventListener("transitionend",(()=>{t.querySelectorAll("img:not(:last-child)").forEach((t=>t.remove()))}),{once:!0})}(o,l))).catch((()=>{console.error("Error al cargar arte de la canción")}));const u=document.querySelector(".miniplayer-cover");if(u){const t=i||a||n||r;document.createElement("img").src=t,c(t).then((()=>{return i=t,(e=u).style.opacity=0,void e.addEventListener("transitionend",(()=>{e.src=i,e.style.opacity=.5,e.addEventListener("transitionend",(()=>{e.removeAttribute("style")}),{once:!0})}));var e,i})).catch((()=>{console.error("Error al cargar la portada de la canción")}))}}null!==k&&($(x),k.addEventListener("input",(t=>{$(t.target.value)})),E.addEventListener("mousedown",(()=>{document.addEventListener("mousemove",z)}))),null!==L&&L.addEventListener("click",(()=>{w.volume>0?$(0):$(100)})),document.addEventListener("mouseup",(()=>{document.removeEventListener("mousemove",z)})),window.addEventListener("resize",(()=>{const t=k.value;U(t),q(t)})),function t(){f&&clearTimeout(f),fetch(g).then((t=>t.json())).then((async t=>{const e={...o(n=t),history:[...s(n)]};var n;if(y!==e.title){y=e.title;const t=function(t){return{artist:t.artistName||t.artist||"Artist",title:t.trackName||t.title||"Title",artwork:{small:r,medium:r,large:r,xl:r}}}(e),n=await(async(t,e="spotify")=>{const r=`${t.artist} ${t.title}`,n=`${r} - ${e}`;if(i[n])return i[n];const a=await l(encodeURIComponent(r)),s={...t,...a},o=t=>a?.artworkUrl100.replace("100x100bb",`${t}x${t}bb`);return a.artworkUrl100&&(s.artwork60=o(60),s.artwork100=o(100),s.artwork300=o(300),s.artwork500=o(500),s.artwork1000=o(1e3)),i[n]=s,s})(t);H(n),function(t){const{title:e,artist:i,album:r,artwork:n,artworkUrl100:a,artworkUrl500:s}=t;"mediaSession"in navigator&&(navigator.mediaSession.metadata=new MediaMetadata({title:e,artist:i,album:r,artwork:[{src:n||a,sizes:"128x128",type:"image/png"},{src:n||s,sizes:"256x256",type:"image/png"},{src:n||s,sizes:"512x512",type:"image/png"}]}),navigator.mediaSession.setActionHandler("play",(()=>{v()})),navigator.mediaSession.setActionHandler("pause",(()=>{A()})))}(n)}})).catch((t=>console.error("Error:",t))),f=setTimeout((()=>{t()}),p)}()}();